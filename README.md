# bigdiff
"diff" tables on BigQuery

# Usage
Compare two tables—`prod_replica.my_table` and `dev_migration.my_table`—whose rows are uniquely identified by the columns `show_timestamp`, `filter_id`, and `namespace_id`.  Store the intermediate results in `_temporary`.  Show me how many rows are missing from each table (along with some examples).  Of the rows found in both tables, show me how many differ in each column (along with texamples).
```
$ bigdiff \
>  --tables prod_replica.my_table dev_migration.my_table \
>  --prime_attributes show_timestamp filter_id namespace_id \
>  --results_dataset _temporary


Number of records "missing" from `my-gcp-project-714m.prod_replica.my_table`:
3793585

+Examples:--+---------------------------+--------------+
| filter_id | show_timestamp            | namespace_id |
+-----------+---------------------------+--------------+
| 143307    | 2019-11-24 05:29:00+00:00 | 1            |
| 143008    | 2020-02-22 08:54:00+00:00 | 1            |
| 143019    | 2019-12-08 09:59:00+00:00 | 1            |
| 143163    | 2019-12-31 19:50:00+00:00 | 1            |
| 143012    | 2020-02-11 10:31:00+00:00 | 1            |
| 143831    | 2020-02-20 03:16:00+00:00 | 1            |
| 143828    | 2020-01-11 12:25:00+00:00 | 1            |
| 142970    | 2020-01-17 18:41:00+00:00 | 1            |
| 143011    | 2020-02-12 05:47:00+00:00 | 1            |
| 135693    | 2019-12-03 07:04:00+00:00 | 1            |
+-----------+---------------------------+--------------+

Number of records "missing" from `my-gcp-project-714m.dev_migration.my_table`:
46

+Examples:--+---------------------------+--------------+
| filter_id | show_timestamp            | namespace_id |
+-----------+---------------------------+--------------+
| 143009    | 2019-07-09 07:00:00+00:00 | 1            |
| 143019    | 2019-07-10 07:00:00+00:00 | 1            |
| 143828    | 2019-07-09 07:00:00+00:00 | 1            |
| 143019    | 2019-07-09 07:00:00+00:00 | 1            |
| 143814    | 2019-07-10 07:00:00+00:00 | 1            |
| 144437    | 2019-07-09 07:00:00+00:00 | 1            |
| 143012    | 2019-07-09 07:00:00+00:00 | 1            |
| 143015    | 2019-07-09 07:00:00+00:00 | 1            |
| 142970    | 2019-07-10 07:00:00+00:00 | 1            |
| 143163    | 2019-07-10 07:00:00+00:00 | 1            |
+-----------+---------------------------+--------------+

Number of records found in both tables:
743232

+------------------------+-------------------+-----------+
| Column Name            | Rows Not Matching | % of Rows |
+------------------------+-------------------+-----------+
| filter_name            | 0                 | 0.0       |
| filter_category        | 0                 | 0.0       |
| plays                  | 0                 | 0.0       |
| ended_plays_timeseries | 0                 | 0.0       |
| uniques                | 477               | 0.06      |
| viewer_hours           | 0                 | 0.0       |
+------------------------+-------------------+-----------+

Sample of records where `uniques` does not match:
+-----------+---------------------------+--------------+---------------------+---------------------+
| filter_id | show_timestamp            | namespace_id | control_table_value | testing_table_value |
+-----------+---------------------------+--------------+---------------------+---------------------+
| 135673    | 2019-07-29 14:00:00+00:00 | 1            | 1982                | 1982.68             |
| 144437    | 2019-07-30 00:00:00+00:00 | 1            | 51475               | 51475.35            |
| 142940    | 2019-07-29 15:00:00+00:00 | 1            | 61                  | 61.38               |
| 143012    | 2019-07-30 00:00:00+00:00 | 1            | 10947               | 10947.84            |
| 135673    | 2019-07-29 09:00:00+00:00 | 1            | 1855                | 1855.87             |
| 143014    | 2019-07-29 20:00:00+00:00 | 1            | 101                 | 101.34              |
| 143012    | 2019-07-30 03:00:00+00:00 | 1            | 6974                | 6974.18             |
| 143814    | 2019-07-29 21:00:00+00:00 | 1            | 132                 | 132.08              |
| 143163    | 2019-07-29 16:00:00+00:00 | 1            | 13                  | 13.04               |
| 143829    | 2019-07-30 03:00:00+00:00 | 1            | 17821               | 17821.98            |
+-----------+---------------------------+--------------+---------------------+---------------------+
```
